version: "3.8"

services:
  clickhouse:
    image: clickhouse/clickhouse-server:latest
    container_name: clickhouse
    networks:
      - blockchain-net
    volumes:
      - ./ch-data:/var/lib/clickhouse
    ports:
      - "8123:8123"
      - "9000:9000"

  rust-app:
    build: .
    container_name: eth-app
    networks:
      - blockchain-net
    depends_on:
      - clickhouse
    environment:
      APP_MODE: ${APP_MODE}

      CLICKHOUSE_URL: http://clickhouse:8123
      CLICKHOUSE_USER: default
      CLICKHOUSE_PASS: ""

      CLICKHOUSE_DB_BTC: btc_db
      CLICKHOUSE_DB_ETH: eth_db

      BTC_API_URL: https://blockstream.info/api
      BTC_START_BLOCK: 831000
      TOTAL_BTC_TXS: 500

      ETH_RPC_HTTP: http://reth-node:8545
      ETH_START_BLOCK: 19000000
      TOTAL_ETH_TXS: 300

networks:
  blockchain-net:
    external: true